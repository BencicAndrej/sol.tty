const Eval = artifacts.require("Eval");

contract("Eval", async accounts => {
    // it("adds two numbers correctly", async () => {
    //     let instance = await Eval.deployed();
    //
    //     const res = await instance.eval.sendTransaction("0x611234600220", "0x123");
    //
    //     console.log(res);
    // });

    // it("processes an empty contract correctly", async () => {
    //     const code = "0x608060405260043610603f576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063c66478d5146044575b600080fd5b348015604f57600080fd5b5060566058565b005b5600a165627a7a72305820b1541a06a51fd17e270291a458f0688105feae44b3f810c2e914659ba887688d0029";
    //     const signature = "0xc66478d5";
    //
    //     let instance = await Eval.deployed();
    //
    //     await instance.sendTransaction({value: 10000});
    //     const res = await instance.eval.call(code, signature);
    //
    //     console.log(res);
    // });

    it("processes transfer", async () => {
        const code = "0x608060405234801561001057600080fd5b506004361061002b5760003560e01c80637daa9efc14610030575b600080fd5b61003861003a565b005b610042610152565b60405180604001604052807306480c93a7acc5769f63f2af20a82069edc2312d73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200173c4dfd227848fbe6640ab14c9c339845bed35066573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815250905060008090505b600281101561014e578181600281106100f457fe5b602002015173ffffffffffffffffffffffffffffffffffffffff166108fc6103e89081150290604051600060405180830381858888f19350505050158015610140573d6000803e3d6000fd5b5080806001019150506100df565b5050565b604051806040016040528060029060208202803883398082019150509050509056fea265627a7a7231582036fe574a5fe8735b227c065a59358892fc87c230569c2156d3d1cbc82d58344064736f6c634300050b0032";
        const signature = "0x7daa9efc";

        let instance = await Eval.deployed();

        await instance.sendTransaction({ value: 10000 });
        const res = await instance.eval.call(code, signature);

        console.log(res);
    });

    describe("It should emit events", () => {
        it("Should emit event with log0", async () => {
            const instance = await Eval.new(accounts[0]);
            // PUSH2 2321 PUSH1 00 MSTORE PUSH1 20 PUSH1 00 LOG0 PUSH 00 DUP RETURN
            const code = "0x61232160005260206000a0600080f3";
            const res = await instance.eval(code, "0x");
            expect(res.receipt.rawLogs[0].data).to.be.equal("0x0000000000000000000000000000000000000000000000000000000000002321");
        });
    });

    // it("processes with return", async () => {
    //     const code = "0x6080604052348015600f57600080fd5b506004361060285760003560e01c80637daa9efc14602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000600a90509056fea265627a7a72315820039f8d7e16098da62c68a507082ce3f36e7e08dc1a53b4874efd2c9968e09e4164736f6c634300050b0032";
    //     const signature = "0x7daa9efc";
    //
    //     let instance = await Eval.deployed();
    //
    //     const res = await instance.eval.call(code, signature);
    //
    //     console.log(res);
    // });


    // it("processes fanout payments", async () => {
    //     const code = "0x608060405234801561001057600080fd5b5060043610610048576000357c010000000000000000000000000000000000000000000000000000000090048063c66478d51461004d575b600080fd5b610055610057565b005b600073c97c0d39ca20366e2c01069f2abfdd50ef0394ca90508073ffffffffffffffffffffffffffffffffffffffff1663e94f1292306040518263ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001915050600060405180830381600087803b15801561010b57600080fd5b505af115801561011f573d6000803e3d6000fd5b505050508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb73fb38cb88d96276d9fb4fed67c1c9839b3d822b1b60016040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156101db57600080fd5b505af11580156101ef573d6000803e3d6000fd5b505050506040513d602081101561020557600080fd5b8101908080519060200190929190505050508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb734787ce2dcde562dde2f9b1b14c691765ee9453d560016040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156102cf57600080fd5b505af11580156102e3573d6000803e3d6000fd5b505050506040513d60208110156102f957600080fd5b8101908080519060200190929190505050508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb73af387e63d09dc44511241716043711c6a90c825b60016040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156103c357600080fd5b505af11580156103d7573d6000803e3d6000fd5b505050506040513d60208110156103ed57600080fd5b8101908080519060200190929190505050508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb73081b0273cd285b7699194c346b76d5a558777b0460016040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156104b757600080fd5b505af11580156104cb573d6000803e3d6000fd5b505050506040513d60208110156104e157600080fd5b8101908080519060200190929190505050508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb733d8cfed1cab3864d89193317076a6fe01976721560016040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b1580156105ab57600080fd5b505af11580156105bf573d6000803e3d6000fd5b505050506040513d60208110156105d557600080fd5b8101908080519060200190929190505050505056fea165627a7a7230582061a163ffecddedb185fe75926eb29bb5ba5e8fb8cbd3bc497f306450dd700a4b0029";
    //     const signature = "0xc66478d5";
    //
    //     let instance = await Eval.deployed();
    //
    //     const res = await instance.eval.call(code, signature);

    // console.log(res);
    // });

    // it("gets correct contract address", async () => {
    //     const code = "0x303100";
    //     const signature = "0xc66478d5";
    //
    //     let instance = await Eval.deployed();
    //
    //     const res = await instance.eval.call(code, signature);
    //
    //     console.log(res);
    // });
});
